\documentclass[a4paper]{article}    % define document layout
%\documentclass[draft]{article}     % use draft option in packages
%-----------------------------
% preamble
%-----------------------------
\usepackage[sumlimits,]{amsmath}    % math equations and formulas
\usepackage[utf8]{inputenc}         % use UTF-8 encoding
\usepackage[english]{babel}         % use English language
\usepackage{graphicx}              % insert images
%\usepackage[draft]{graphicx}        % do not render figures
\usepackage{subcaption}             % multiple images in one figure
\usepackage{hyperref}               % hyperlinks
\usepackage{float}                  % floating objects (figures, tables)
\usepackage{geometry}               % page size and margins
\geometry{a4paper, margin=1in}      % margins
\usepackage{ragged2e}               % text alignment
\usepackage[table]{xcolor}          % change cell color in tables
%\usepackage{multirow}               % merge rows in table

\graphicspath{                      % path for figures
    {../figures/} 
    {../figures/alpha/} 
    {../figures/cm/} 
    {../figures/heatmap/} 
    {../figures/misclassified/} 
}

%-----------------------------
% body
%-----------------------------
\begin{document}

\begin{figure}
    \centering
    % UNICAMP logo
    \begin{subfigure}{0.45\textwidth}
        \centering
        \includegraphics[width=1.5cm]{unicamp}
%        \label{fig:unicamp}
    \end{subfigure}
    \hfill
    % FEEC logo
    \begin{subfigure}{0.45\textwidth}
        \centering
        \includegraphics[width=1.5cm]{feec}
%        \label{fig:feec}
    \end{subfigure}
\end{figure}

\title{
    \vspace{5cm}
    IA353A - Neural Networks\\
    EFC2 - Question 2
    \vspace{1cm}
}
\author{
    Rafael Claro Ito\\
    (R.A.: 118430)
    \vspace{11cm}
}
%R.A.: 118430
%ito.rafael@gmail.com
\date{May 2020}
\maketitle
\newpage

%=================================================
\section{Source files}
%=================================================

\paragraph{The Jupyter notebook with the code used to generate the plots and results presented in this report, all figures showed here and even the \LaTeX \space source code used to generate this PDF can be found at the following GitHub repository:}

\begin{center}
    {\url{https://github.com/ito-rafael/IA353A-NeuralNetworks-1s2020}}
\end{center}

%=================================================
\section{Extreme Learning Machine}
%=================================================

%-------------------------------------------------
\setcounter{subsection}{-1}
\subsection{Regularization coefficient (Ridge Regression)}
%-------------------------------------------------

\begin{table}[H]
    \begin{center}
        \begin{tabular}{r|c|c|} 
            \cline{2-3}
            & \multicolumn{2}{|c|}{\cellcolor[gray]{0.8}{$\lambda$ optimum}} \\
            \cline{2-3}
            & \cellcolor[gray]{0.8}{MSE} & \cellcolor[gray]{0.8}{Accuracy} \\
            \cline{1-3}
            \multicolumn{1}{|r|}{\cellcolor[gray]{0.8}{coarse search}} & 64   & 256   \\
            \cline{1-3}
            \multicolumn{1}{|r|}{\cellcolor[gray]{0.8}{fine search}}   & 102.7 & 662.7 \\
            \cline{1-3}
        \end{tabular}
    \end{center}
    \caption{Values of regularization coefficient found in coarse and fine searches}
    \label{tab:alpha_results}
\end{table}

%-------------------------------------------------
\subsubsection{Coarse search}
%-------------------------------------------------

\paragraph{While performing the coarse search for the best regularization coefficient, 3 more values of lambda were added. This was done in order to see the falling of the accuracy curve, even though the best accuracy was in $2^{8}$. The final values of lambda tested were:}

\begin{center}
    alpha\_interval = $[2^{-10}, 2^{-8}, 2^{-6}, 2^{-4}, 2^{-2}, 2^{0}, 2^{2}, 2^{4}, 2^{6}, 2^{8}, 2^{10}, \boldsymbol{2^{11}, 2^{12}, 2^{13}}]$
\end{center}

\begin{figure}[H]
    \centering
    % digit 0
    \begin{subfigure}{0.48\textwidth}
        \centering
        \includegraphics[width=7.5cm]{alpha_MSE_coarse_search}
        \caption{MSE progression}
        \label{fig:alpha-coarse-mse}
    \end{subfigure}
    \hfill
    % digit 1
    \begin{subfigure}{0.48\textwidth}
        \centering
        \includegraphics[width=7.5cm]{alpha_ACCURACY_coarse_search}
        \caption{Accuracy progression}
        \label{fig:alpha-coarse-acc}
    \end{subfigure}
    \hfill
    % caption and label
    \caption{Progression of MSE and accuracy in validation set for different values of the regularization coefficient (coarse search)}
    \label{fig:alpha_coarse}
\end{figure}

%-------------------------------------------------
\subsubsection{Fine search}
%-------------------------------------------------

\paragraph{In order to perform the fine search of the regularization coefficient, a golden-section one dimensional search algorithm was coded. Among the function parameters, the most important ones are the intervals of the search, precision desired and the loss function. The code can be found in:\\
\url{https://github.com/ito-rafael/machine-learning/blob/master/snippets/golden_section_search_valid.py}}

\begin{figure}[H]
    \centering
    % digit 0
    \begin{subfigure}{0.48\textwidth}
        \centering
        \includegraphics[width=7.5cm]{alpha_MSE_fine_search}
        \caption{MSE progression)}
        \label{fig:alpha-fine-mse}
    \end{subfigure}
    \hfill
    % digit 1
    \begin{subfigure}{0.48\textwidth}
        \centering
        \includegraphics[width=7.5cm]{alpha_ACCURACY_fine_search}
        \caption{Accuracy progression)}
        \label{fig:alpha-fine-acc}
    \end{subfigure}
    \hfill
    % caption and label
    \caption{Progression of MSE and accuracy in validation set for different values of the regularization coefficient (fine search)}
    \label{fig:alpha_fine}
\end{figure}

%=================================================
\subsection{Confusion Matrix and Misclassification}
%=================================================

\paragraph{Considering the training set, plot the confusion matrix and a few examples of misclassified digits from at least three different classes.}

%-------------------------------------------------
\subsubsection{Confusion Matrix}
%-------------------------------------------------

\paragraph{The values displayed in the confusion matrix were obtained with the extreme learning machine applied to the training set (training plus validation). The training set is somewhat balanced, containing the number of samples for each class as illustrated in Figure \ref{tab:samples_training_set}}

\begin{table}[H]
    \begin{center}
        \begin{tabular}{|c|c|} 
            \cline{1-2}
            \cellcolor[gray]{0.8}{Digit} & \cellcolor[gray]{0.8}{nÂº of samples} \\
            \cline{1-2}
            0 & 5923 \\
            1 & 6742 \\
            2 & 5958 \\
            3 & 6131 \\
            4 & 5842 \\
            5 & 5421 \\
            6 & 5918 \\
            7 & 6265 \\
            8 & 5851 \\
            9 & 5949 \\
            \cline{1-2}
        \end{tabular}
    \end{center}
    \caption{Number of samples for each class in the training set}
    \label{tab:samples_training_set}
\end{table}

\begin{figure}[H]
    \centering
    % digit 0
    \begin{subfigure}{0.48\textwidth}
        \centering
        \includegraphics[width=7.5cm]{cm_raw}
        \caption{Confusion matrix with raw values}
        \label{fig:cm_raw}
    \end{subfigure}
    \hfill
    % digit 1
    \begin{subfigure}{0.48\textwidth}
        \centering
        \includegraphics[width=7.5cm]{cm_norm}
        \caption{Confusion matrix with normalized values}
        \label{fig:cm_norm}
    \end{subfigure}
    \hfill
    % caption and label
    \caption{Confusion matrix with normalized and raw values} 
    \label{fig:cm}
\end{figure}

%-------------------------------------------------
\subsubsection{Misclassified data}
%-------------------------------------------------

\paragraph{The digits shown in Figure \ref{fig:misclassified_digits} are in the top 30 misclassified digits from which the difference between the output for the real class and the output for the predicted class are the highest. Both real and predicted class and its outputs values associated are indicated. The output is shown in parenthesis, in front of the correspondent class.}

\begin{figure}[H]
    \centering
    % example 1
    \begin{subfigure}{0.32\textwidth}
        \centering
        \includegraphics[width=5.0cm]{1}
        \caption{
            Real class: 3 (0.02)\\
            Predicted class: 7 (1.25)}
        \label{fig:example_1}
    \end{subfigure}
    \hfill
    % example 2
    \begin{subfigure}{0.32\textwidth}
        \centering
        \includegraphics[width=5.0cm]{4}
        \caption{
            Real class: 7 (0.10)\\
            Predicted class: 0 (1.06)}
        \label{fig:example_2}
    \end{subfigure}
    \hfill
    % example 3
    \begin{subfigure}{0.32\textwidth}
        \centering
        \includegraphics[width=5.0cm]{8}
        \caption{
            Real class: 4 (0.02)\\
            Predicted class: 7 (0.90)}
        \label{fig:example_3}
    \end{subfigure}
    \hfill
    % example 4
    \begin{subfigure}{0.32\textwidth}
        \centering
        \includegraphics[width=5.0cm]{11}
        \caption{
            Real class: 9 (-0.12)\\
            Predicted class: 7 (0.73)}
        \label{fig:example_4}
    \end{subfigure}
    \hfill
    % example 5
    \begin{subfigure}{0.32\textwidth}
        \centering
        \includegraphics[width=5.0cm]{12}
        \caption{
            Real class: 5 (-0.07)\\
            Predicted class: 6 (0.78)}
        \label{fig:example_5}
    \end{subfigure}
    \hfill
    % example 6
    \begin{subfigure}{0.32\textwidth}
        \centering
        \includegraphics[width=5.0cm]{14}
        \caption{
            Real class: 4 (0.14)\\
            Predicted class: 0 (0.97)}
        \label{fig:example_6}
    \end{subfigure}
    \hfill
    % example 7
    \begin{subfigure}{0.32\textwidth}
        \centering
        \includegraphics[width=5.0cm]{17}
        \caption{
            Real class: 9 (-0.04)\\
            Predicted class: 0 (0.77)}
        \label{fig:example_7}
    \end{subfigure}
    \hfill
    % example 8
    \begin{subfigure}{0.32\textwidth}
        \centering
        \includegraphics[width=5.0cm]{18}
        \caption{
            Real class: 1 (-0.14)\\
            Predicted class: 7 (0.66)}
        \label{fig:example_8}
    \end{subfigure}
    \hfill
    % example 9
    \begin{subfigure}{0.32\textwidth}
        \centering
        \includegraphics[width=5.0cm]{19}
        \caption{
            Real class: 3 (-0.14)\\
            Predicted class: 8 (0.66)}
        \label{fig:example_9}
    \end{subfigure}
    \hfill
    % example 10
    \begin{subfigure}{0.32\textwidth}
        \centering
        \includegraphics[width=5.0cm]{22}
        \caption{
            Real class: 8 (-0.03)\\
            Predicted class: 4 (0.74)}
        \label{fig:example_10}
    \end{subfigure}
    \hfill
    % example 11
    \begin{subfigure}{0.32\textwidth}
        \centering
        \includegraphics[width=5.0cm]{24}
        \caption{
            Real class: 5 (-0.11)\\
            Predicted class: 6 (0.65)}
        \label{fig:example_11}
    \end{subfigure}
    \hfill
     % example 12
    \begin{subfigure}{0.32\textwidth}
        \centering
        \includegraphics[width=5.0cm]{29}
        \caption{
            Real class: 6 (0.09)\\
            Predicted class: 4 (0.82)}
        \label{fig:example_12}
    \end{subfigure}
    \hfill
    % caption and label
    \caption{Misclassified digits} 
    \label{fig:misclassified_digits}
\end{figure}

\newpage

%=================================================
\subsection{Performance and computational resources improvements}
%=================================================

%=================================================
\subsection{Regularization coefficients comparison}
%=================================================

%=================================================
\subsection{Results for a different initialization}
%=================================================

%=================================================
\subsection{Modifications aiming better results}
%=================================================

%=================================================
\end{document}

